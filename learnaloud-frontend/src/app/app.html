<div class="app-container">
  <header class="app-header">
    <h1>LearnAloud</h1>
    <span class="subtitle">Voice-Synchronized PDF Teaching Assistant</span>
  </header>

  <div class="main-content">
    <section class="pdf-section">
      @if (pdfUrl) {
        <app-pdf-viewer
          [pdfUrl]="pdfUrl"
          [highlightCommands]="highlightCommands"
        ></app-pdf-viewer>
      } @else {
        <div class="upload-area">
          <div class="upload-prompt">
            <p class="upload-icon">&#128196;</p>
            <p>Upload a PDF to get started</p>
            <label class="upload-btn" for="pdfInput">Choose PDF File</label>
            <input
              id="pdfInput"
              type="file"
              accept="application/pdf"
              (change)="onFileSelected($event)"
              hidden
            />
          </div>
        </div>
      }
    </section>

    <aside class="controls-section">
      <div class="controls-panel">
        <h2>Controls</h2>

        @if (pdfUrl) {
          <p class="file-name">{{ uploadedFileName }}</p>

          <!-- Voice controls -->
          <div class="voice-controls">
            @if (!isVoiceConnected && !isVoiceConnecting) {
              <button
                class="voice-btn voice-start"
                (click)="startVoiceSession()"
              >
                Start Voice Session
              </button>
            }

            @if (isVoiceConnecting) {
              <button class="voice-btn voice-start" disabled>
                Connecting...
              </button>
            }

            @if (isVoiceConnected) {
              <div class="voice-active">
                <span class="voice-indicator"></span>
                <span>Voice Active</span>
              </div>
              <div class="voice-action-row">
                <button
                  class="voice-btn voice-mic"
                  (click)="toggleMic()"
                >
                  {{ isMicMuted ? 'Unmute Mic' : 'Mute Mic' }}
                </button>
                <button
                  class="voice-btn voice-disconnect"
                  (click)="disconnectVoice()"
                >
                  Disconnect
                </button>
              </div>
            }

            @if (voiceError) {
              <p class="voice-error">{{ voiceError }}</p>
            }
          </div>

          <hr class="controls-divider" />

          <button
            class="demo-btn"
            (click)="startDemo()"
            [disabled]="isDemoRunning"
          >
            {{ isDemoRunning ? 'Demo Running...' : 'Start Teaching Demo' }}
          </button>
          <label class="upload-btn reupload" for="pdfInputAlt">Upload Different PDF</label>
          <input
            id="pdfInputAlt"
            type="file"
            accept="application/pdf"
            (change)="onFileSelected($event)"
            hidden
          />
        }

        @if (statusMessage) {
          <p class="status">{{ statusMessage }}</p>
        }
      </div>

      @if (isVoiceConnected && transcriptEntries.length > 0) {
        <div class="transcript-panel">
          <h3>Transcript</h3>
          <div class="transcript-messages">
            @for (entry of transcriptEntries; track entry.id) {
              <div class="transcript-entry" [class.transcript-you]="entry.sender === 'you'" [class.transcript-agent]="entry.sender === 'agent'" [class.transcript-partial]="!entry.isFinal">
                <span class="transcript-sender">{{ entry.sender === 'you' ? 'You' : 'Tutor' }}:</span>
                {{ entry.text }}
              </div>
            }
          </div>
        </div>
      }

      <div class="instructions">
        <h3>How It Works</h3>
        <ol>
          <li>Upload a PDF document</li>
          <li>Click <strong>Start Voice Session</strong> to talk to the AI tutor</li>
          <li>Watch as the AI tutor highlights key concepts in real-time</li>
        </ol>
        <p class="note">
          Use <strong>Start Voice Session</strong> to connect to the Vocal Bridge
          AI agent via LiveKit. The agent will speak, listen, and highlight
          relevant text as it teaches. The <strong>Teaching Demo</strong> button
          runs a simulated highlight sequence for testing without a voice agent.
        </p>
      </div>
    </aside>
  </div>
</div>
